KIẾN TRÚC VÀ SƠ ĐỒ LUỒNG TỔNG THỂ HỆ THỐNG PALLETIZING PLC S7-400H
=========================================================================

I. TỔNG QUAN HỆ THỐNG
=====================
- Hệ thống PLC: Siemens S7-400H (High Availability - Redundant System)
- CPU: CPU 412-3H với khả năng redundant tích hợp
- Ứng dụng: Hệ thống palletizing kết nối với robot ABB IRC5
- Kiến trúc: Gồm 2 khu vực sản xuất độc lập (Area 1 & Area 2)
- Ngôn ngữ lập trình: STL (Statement List)
- Redundancy: Hot-standby với failover time <100ms

II. CẤU TRÚC DATA BLOCKS
========================
DB1-DB2:   Cấu hình hệ thống và cài đặt parameters
DB5-DB7:   Data Area 1 (Line 1)
DB10:      Control Area 1 
DB55-DB57: Data Area 2 (Line 2) 
DB60:      Control Area 2

III. CẤU TRÚC FUNCTION BLOCKS
=============================
FB5:  Function Block xử lý logic cơ bản
FB7:  Function Block xử lý timer và counter

IV. CẤU TRÚC FUNCTIONS (FC)
===========================
FC8:   Chuyển đổi time format
FC34:  Xử lý thời gian (IEC Standard)
FC50:  Điều khiển Area 1 - Logic chính
FC51:  Điều khiển Area 1 - Xử lý I/O và alarm
FC52:  Điều khiển Area 1 - Xử lý robot communication
FC53:  Điều khiển Area 1 - Position control
FC54:  Điều khiển Area 1 - Safety interlocks
FC55:  Điều khiển Area 1 - Data logging
FC60:  Điều khiển Area 2 - Logic chính
FC61:  Điều khiển Area 2 - Xử lý I/O và alarm
FC62:  Điều khiển Area 2 - Xử lý robot communication
FC63:  Điều khiển Area 2 - Position control
FC64:  Điều khiển Area 2 - Safety interlocks
FC65:  Điều khiển Area 2 - Data logging
FC102: Diagnostic Area 1
FC103: Recipe management Area 1
FC112: Diagnostic Area 2
FC113: Recipe management Area 2

V. CẤU TRÚC ORGANIZATION BLOCKS
===============================
OB1:   Main program - Cyclic execution
OB35:  Cyclic interrupt (100ms)
OB70:  Startup error handling
OB72:  Module error handling
OB80-88: Diagnostic error handling
OB100: Warm restart
OB102: Cold restart
OB121-122: Programming error handling

VI. SƠ ĐỒ LUỒNG CHÍNH (MAIN SIGNAL FLOW)
==========================================

┌─────────────────────────────────────────────────────────────────┐
│                        OB1 - MAIN PROGRAM                      │
│                     (Cyclic Execution)                         │
└─────────────────────┬───────────────────────────────────────────┘
                      │
    ┌─────────────────┴─────────────────┐
    │                                   │
    ▼                                   ▼
┌─────────────────┐                ┌─────────────────┐
│   AREA 1        │                │   AREA 2        │
│   LINE 1        │                │   LINE 2        │
└─────┬───────────┘                └─────┬───────────┘
      │                                  │
      ▼                                  ▼
┌─────────────────┐                ┌─────────────────┐
│ DB5,6,7 + DB10  │                │ DB55,56,57+DB60 │
│ (Data Storage)  │                │ (Data Storage)  │
└─────┬───────────┘                └─────┬───────────┘
      │                                  │
      ▼                                  ▼
┌─────────────────┐                ┌─────────────────┐
│ FC50-FC55 +     │                │ FC60-FC65 +     │
│ FC102-FC103     │                │ FC112-FC113     │
│ (Control Logic) │                │ (Control Logic) │
└─────┬───────────┘                └─────┬───────────┘
      │                                  │
      ▼                                  ▼
┌─────────────────┐                ┌─────────────────┐
│ ROBOT ABB IRC5  │                │ ROBOT ABB IRC5  │
│ Communication   │                │ Communication   │
└─────────────────┘                └─────────────────┘

VII. LUỒNG ĐIỀU KHIỂN CHI TIẾT
===============================

1. KHỞI ĐỘNG HỆ THỐNG:
   OB100/OB102 → Initialization → Safety Check → Area Enable

2. LUỒNG AREA 1 (M12.0 = TRUE):
   Input Check → FC50 (Main Logic) → FC51 (I/O Processing) →
   FC52 (Robot Comm) → FC53 (Position) → FC54 (Safety) → FC55 (Logging)

3. LUỒNG AREA 2 (M515.0 = TRUE):
   Input Check → FC60 (Main Logic) → FC61 (I/O Processing) →
   FC62 (Robot Comm) → FC63 (Position) → FC64 (Safety) → FC65 (Logging)

4. SAFETY INTERLOCKS:
   - Emergency Stop: I0.0, I0.4 (Area 1) | I12.0, I12.4 (Area 2)
   - Light Curtain: I65.5 (Common)
   - Robot Safety: I64.x (Robot Status)

5. COMMUNICATION PROTOCOL:
   - PLC ←→ Robot: Digital I/O + Analog signals
   - Status Words: QW66, QW68, QW70 (Area 1) | QW registers (Area 2)
   - Position Data: Recipe management through FC103/FC113

VIII. CHẾ ĐỘ HOẠT ĐỘNG
=======================
1. MANUAL MODE: Operator control through HMI
2. AUTOMATIC MODE: Recipe-based palletizing
3. MAINTENANCE MODE: Individual axis control
4. DIAGNOSTIC MODE: Error analysis và troubleshooting

IX. ALARM VÀ DIAGNOSTIC
=======================
- System Alarms: DB10.DBW100 (Area 1) | DB60.DBW100 (Area 2)
- Robot Communication Errors: FC102/FC112
- Safety Violations: Emergency stop handling
- Position Errors: Encoder feedback validation

X. ĐỒNG BỘ HÓA HỆ THỐNG
========================
- Cycle Time: 100ms (OB35)
- Robot Sync: Handshake protocol via digital I/O
- Safety Monitoring: Continuous trong OB1
- Data Logging: Real-time qua FC55/FC65
- CPU Redundancy: Continuous sync via fiber optic cables
- Failover Time: <100ms bumpless transfer

Ghi chú: Hệ thống S7-400H được thiết kế để 2 area hoạt động độc lập,
với khả năng redundant tích hợp đảm bảo uptime >99.9%, cho phép 
maintenance một area trong khi area khác vẫn sản xuất liên tục.
